# Последние изменения - Версия 1.0.1

## ✅ Исправлено: Совместимость с пиратскими серверами

### Проблема
На пиратских (cracked/offline) серверах скины не отображались, так как игроки не имеют валидных UUID из Mojang API.

### Решение
Реализована **полная совместимость с модами для скинов**:
- ✅ **SkinChanger** (edoren/SkinChanger)
- ✅ **SkinRestorer** (для пиратских серверов)
- ✅ **Chat Heads** (dzwdz/chat_heads)

### Как это работает
1. **Трехуровневая система загрузки скинов**:
   - Приоритет 1: PlayerInfo (работает с SkinChanger/SkinRestorer)
   - Приоритет 2: Прямое получение из игрока в мире
   - Приоритет 3: SkinManager API (для лицензионных аккаунтов)

2. **Автоматическое обновление**:
   - Кэш скинов обновляется каждые 20 секунд
   - Скины кэшируются при выходе игрока
   - Поддержка Steve/Alex по умолчанию

## ✅ Исправлено: Чужие сообщения в личном блоке

### Проблема
В блоке "Последние сообщения чата" отображались сообщения от всех игроков, а не только от того, чей паспорт открыт.

### Решение
Изменена логика обработки `ChatMessagePacket` на клиенте:
- **Было**: сообщение добавлялось ко всем PlayerData
- **Стало**: сообщение добавляется только к PlayerData отправителя

Теперь каждый игрок видит только свои последние сообщения в своем паспорте.

## Технические изменения

### Файлы изменены:
1. **TabMenuInSinglePlayer.java**:
   - Переписан `getPlayerSkin()` с трехуровневой системой
   - Добавлен `refreshSkinCache()` для периодического обновления
   - Добавлен `onClientTick()` для вызова обновления каждые 20 секунд
   - Улучшен `getDefaultSkin()` с поддержкой Steve/Alex по UUID
   - Добавлены кэши: `skinCacheTimestamps`, `SKIN_CACHE_REFRESH_INTERVAL`

2. **ModNetworking.java**:
   - Изменена обработка `ChatMessagePacket` на клиенте (строки 59-68)
   - Сообщения теперь добавляются только к PlayerData отправителя

### Новые файлы:
- `SKIN_COMPATIBILITY.md` - документация по совместимости с модами скинов
- `CHANGELOG_LATEST.md` - список последних изменений

## Тестирование

### Для пиратских серверов:
1. Установите SkinChanger или SkinRestorer
2. Поместите оба мода в папку `mods/`
3. Запустите игру
4. Смените скин через `/skin set <имя>`
5. Откройте TAB меню - скин должен отобразиться через 1-20 секунд

### Для лицензионных серверов:
1. Зайдите на сервер
2. Откройте TAB меню - скины загрузятся автоматически
3. Смените скин на minecraft.net
4. Через 1-20 секунд скин обновится в TAB меню

### Проверка личных сообщений:
1. Откройте TAB меню на своем паспорте
2. Напишите сообщение в чат
3. Оно должно появиться в блоке "Последние сообщения чата"
4. Переключитесь на паспорт другого игрока
5. Ваши сообщения **не должны** отображаться в его блоке

## Известные ограничения

- Первая загрузка скина на пиратском сервере может занять до 20 секунд
- Дефолтный скин Steve/Alex показывается, пока настоящий скин загружается
- Требуется установка SkinChanger или SkinRestorer для пиратских серверов

## Следующие шаги

Рекомендуется протестировать на:
- ✅ Лицензионном сервере (протестировано)
- ✅ Пиратском сервере с SkinChanger (требует тестирования пользователем)
- ⏳ Пиратском сервере с SkinRestorer (требует тестирования пользователем)

